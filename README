/*******************************************************************************

    Author ......... Jimmy Conner
    Contact ........ jimmy@sqmail.org
    Home Site ...... http://cactiusers.org
    Program ........ Thold for Cacti
    Purpose ........ Threshold Alert module

*******************************************************************************/


----[ Purpose

	This plugin is for the alerting of data found within any graph within Cacti.

----[ Installation

	To install the plugin, please refer to the Plugin Installation Documentation

	Thold requires the Settings plugin to be installed.
    
----[ Possible Bugs?
   
	If you find a problem, let me know!!! http://cactiusers.org/bugs/

----[ Future Changes

	Got any ideas or complaints, please e-mail me!

----[ Changelog

	--- 0.5 ---
    Bug#0001753: Lotus Notes are unable to render inline png pictures 
    Bug#0001810: Thold: RRDTool 1.4.x error while determining last RRD value 
    Bug: Fix for compatibility with other plugins using datasource action hook
    Bug: Re-add syslog messages for down hosts
    Bug: Fixed a few minor issues
    Bug: Allow the use of query_XYZ in CDEFs
    Bug: Fix host status page to only allow users to see hosts they have access to
    Bug: Fix ru_nswap errors on Windows
    Bug: Actions did not work with other plugins from Graphs and Data Sources pages
    Feature: Add support for RPN Expressions
    Feature: Add support for Alert Escalation (Multiple Alerts per Threshold)
    Feature: Add support for Alerts via Script Execution
    Feature: Add support for Alerts via SNMP Writes
    Feature: Make restoration email optional per individual alert
	
	--- 0.4.1 ---
    Feature: Add thold statistics to settings table to allow graphing the results
    Bug: Return False from host status check function if it is disabled
    Bug: Speed up Datasource Query on Told Tab
    Bug: Fix CDEF usage
    Bug: Fix Thold Add Wizard Bug with IE6/7
    Bug: Fix HTTP_REFERER error
    Bug: Fix duplicate function names (when improperly installing plugin)

	--- 0.4.0 ---
    Bug: Fix for multiple poller intervals, use RRD Step of Data Source instead of Polling Interval
    Bug: Fix for down host alerting on disabled hosts
    Feature: Add filtering to listthold.php
    Feature: Use time periods instead of number of pollings when specifying Repeat Alerts and Fail Triggers
    Feature: Time Based Threshold Checking
    Feature: Percentage Calculation
    Feature: Add Threshold Sub Tabs with Both Threshold and Host Status
    Feature: Allow Naming of Threshold Templates and Thresholds
    Feature: Allow Thresholds to be added in mass via a Data Sources dropdown
    Feature: Allow Thresholds to be added in mass via a Graph Management dropdown
    Feature: Added Background Color Legend for Multiple Interfaces
    Feature: Add Threshold creation Wizard
    Feature: Make Wizard Design Consistent
    Feature: Add Filtering to User Threshold View and Host Status View
    Feature: Allow Disable/Enable/Edit/View Graph Actions from Main Page
    Feature: Allow Edit Host from Host Status
    Feature: Enable Toggle VRULE On/Off to show breached Thresholds on the graph images
    Feature: Allow Adding Thresholds from Graphs Page
    Feature: Use Cacti User Permissions when viewing and editing Thresholds
    Feature: Allow Weekend Exemptions per Threshold
    Feature: Allow the disabling of the Restoration Email per Threshold
    Feature: Allow logging of all Threshold Breaches to Cacti Log File
    Feature: Allow logging of all Threshold creations / changing / deletions to Cacti Log File
    Feature: Allow global disabling of all Thresholds
    Feature: Allow setting of Syslog Facility for Syslog Logging
		
	--- 0.3.9 ---
    Feature: Major poller speed increase when using large numbers of thresholds

	--- 0.3.8 ---
    Bug: Fix undefined variable error on thold.php

	--- 0.3.7 ---
    Bug: Fix issue with thold.php not correctly saving the host id
    Bug: Fix issue with Setting plugin having to be before thold in the plugins array
		
	--- 0.3.6 ---
    Feature: Compatible with Cacti v0.8.7 (not backwards compatible with previous versions)
    Bug: Fixed issue with saving user email addresses
    Bug: Fixed issue with tab images

	--- 0.3.5.2 ---
    Bug: Fix issues for users not using latest SVN of the Plugin Architecture

	--- 0.3.5.1 ---
    Bug: Fix for latest Cacti v0.8.6k SVN (requires latest SVN of Plugin Architecture)

	--- 0.3.5 ---
    Bug: Fix for thold values being off when using different polling intervals
    Bug: Fix for creating multiple thresholds via templates from the same DataSource
    Bug: Fix for threshold template data propagating to an incorrect threshold
    Feature: Update plugin to use the Settings plugin for mail functionality
    Feature: Use new "api_user_realm_auth" from Plugin Architecture
    Feature: Added Email Address field to User's Profiles
    Feature: Added ability to select a user to alert for a threshold instead of having to type in their email address
    Feature: Change to using the Settings plugin for mail functionality

	--- 0.3.4 ---
    Bug: Fix issue with host alerts still being sent as multipart messages
    Bug: Fix an issue when applying thresholds to a device with no datasources / dataqueries
    Feature: Allow text only threshold alerts (aka no graph!)
    Feature: Add some text to the alerts, including the hostname
    Feature: Change the email to be sent as "Cacti" instead of PHPMailer
    Feature: Add the ability to completely customize the threshold alert (allow descriptors)
    Feature: Re-arrange the Settings page to group like options
    Feature: Add the ability for template changes to propagate back to the thresholds (with the ability to disable per threshold)

	--- 0.3.3 ---
    Bug: #0000076 - Fix to speed up processing of thresholds (thanks mikv!)
    Bug: #0000079 - Bug causing thold to not respect the others plugins device page actions
    Bug: Fix an issue with re-alert set to 0 still alerting
    Bug: Fix the host down messages, this will work with cactid also
    Feature: Host Down messages are now sent as text only emails

	--- 0.3.2 ---
    Bug: Fix an index error message displayed when clicking the auto-creation link
    Bug: Fix an issue with thresholds not switching into "is still down" mode when alerting
    Bug: Fix a rare error where under certain conditions no data is passed back to threshold during polling
			
	--- 0.3.1 ---
    Bug: #0000035 - Does not handle INDEXED data sources correctly
    Bug: #0000038 - Thresholding non-integer does not seem to work
    Bug: #0000041 - Subject of mail message now reflects the data source item (also #0000066)
    Bug: #0000059 - Thold always displays and assigns only one associated graph with the lowest graph_id
    Bug: #0000060 - Issue with "nan" values in the RRD File
    Bug: #0000062 - Step value of the rra is not considered for fetching rrd values
    Bug: #0000063 - CDEF function error (100 -DS)
    Bug: Fix a php short tag issue on graph_thold.php
    Feature: Patch from William Riley to allow the threshold management page to be split into separate pages	
    Feature: Major rewrite of thold processing, now we pull from the poller output table instead of directly from the rrd files
    Feature: Major code cleanup in a few files
    Feature: Remove the tholdset table
    Feature: Remove the thold table
    Feature: Add an option for the priority level used when syslogging
    Feature: Add the option allow applying thresholds to multiple hosts at once through the Devices page
	
	--- 0.3.0 ---
    Bug: #0000040 - Fix issue with invalid link in Navigation panel under certain circumstances
    Bug: #0000048 - Fix improper notification of global address when Threshold set to "Force: Off"
    Bug: #0000042 - Add ability to apply a CDEF to the threshold before using the data
    Bug: #0000054 - Fix issue with CDEFs on manual threshold creating page
	
	--- 0.2.9 ---
    Bug: #0000021 - Fix for rare SQL errors when auto-creating Thresholds when no Graph is associated with a Datasource
    Bug: #0000024 - Thold Templates not allowing for NULL Upper or Lower Baselines
    Bug: #0000031 - When creating Thresholds and Templates, default values were not provided
    Bug: #0000032 - Validation Error on listthold.php when selecting "Show All"
    Bug: Fix for Undefined offset in thold.php
    Feature: Added some more POST validation to Threshold Templates
    Feature: Changed the font size for the Auto-Create Thold Messages

	--- 0.2.8 ---
    Bug: #0000013 - Fix issues with database names with uncommon characters by enclosing in back-ticks.
    Bug: #0000005 - Fix for threshold values not matching the graph values
    Feature: #0000030 - Allow use of decimal values in thresholds up to 4 decimal places
    Feature: Change "Thresholds" to "Threshold Templates"
		
	--- 0.2.7 ---
    Bug: Fixes for "are you sure you meant month 899" errors
    Bug: Fixes for table tholdset being empty causes poller to not function
    Bug: Resolved issue with Base URL auto generation pointing to the plugin directory
    Bug: Code Cleanup of Threshold Management Page
    Bug: "Instructions" rewording on Threshold Management Page
    Bug: Orphan thresholds are now cleaned up automatically
    Bug: Fixed Guest account access to View Thresholds
    Feature: Can now select multiple Thresholds to delete

	--- 0.2.6 ---
    Bug: Fixes for HI and Low thresholds limiting the max characters
    Bug: Fixed wrong data reported to thold.log
    Bug: Fix for the error: "sh: line 1: -e: command not found" during thold checks
    Bug: Fixed the Test Email link for IE
    Feature: Added command line switch /show for check-thold.php, which will show the output of all thresholds
    Feature: Added command line switch /debug to allow it to log to file (to make it permanent, just set debug=1 in the file)

	--- 0.2.5 ---
    Bug: Several fixes to the Threshold Mailing (SMTP especially was broken)
    Bug: Several fixes to the Down Host Notification
    Feature: Test Link Created to help debug mail sending issues

	--- 0.2.4 ---
    Bug: A few other minor interface fixes
    Feature: Added Threshold Templates

	--- 0.2.3 ---
    Bug: Fixed the Host Down Notification
    Feature: Emails now use embedded PNG images (instead of links)
    Feature: Option to send mail via PHP Mail function, Sendmail, or SMTP (even authenicated)
    Feature: Set the from email address and name
		 
	--- 0.2.0 ---
    Bug: Lots of bug fixes for issues in the original threshold module
    Feature: Auto-create the database if it doesn't exist
    Feature: Better sorting on threshold tables
    Feature: Does not require its own cron job anymore

